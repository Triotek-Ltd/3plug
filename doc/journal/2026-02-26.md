# Journal - 2026-02-26

## Focus
Complete PLT docs-first translation foundations so PLT submodule docs become the source of truth for backend/runtime work, then prepare the process to be reused for `ADM`, `OPS`, and `MGT`.

## Current State
- PLT route screens in `src` are implemented in flow order (auth -> home/launcher -> account -> admin -> publisher), but many still rely on temporary shell/session fallbacks.
- PLT submodule docs already existed structurally (`doc.json`, `schema.json`, `actions.json`) across `324` doc folders, but were scaffold-empty for `schema.fields`.
- PLT module `doctype` artifacts exist as scaffolds and contain useful metadata (permissions/default view/sort), but not usable field sets or meaningful `.py/.js` logic.

## Changes Made
- Added a PLT docs-first translation/seeding plan:
  - `doc/mapping/plt_doc_translation_and_seeding_plan.md`
- Added PLT doc runtime generator (writes inside submodule `docs/<doc_key>/`):
  - `scripts/plt_generate_doc_runtime.py`
  - Generates `<doc_key>.json`, `<doc_key>.py`, `<doc_key>.js`
- Added PLT translation inventory/report:
  - `scripts/plt_doc_translation_inventory.py`
  - Output: `doc/mapping/plt_translation_inventory.json`
- Added exact-only PLT mapping workflow:
  - `doc/mapping/plt_doctype_to_doc_mapping_exact.json`
  - `scripts/plt_seed_schema_from_exact_frappe_mappings.py`
- Added PLT seed candidate helpers (for review, not direct seeding):
  - `scripts/plt_generate_frappe_mapping_seed.py`
  - `scripts/plt_fill_exact_mapping_candidates_from_seed.py`
  - `scripts/plt_expand_exact_mapping_template.py`
- Added native fallback seeder for unmapped PLT docs:
  - `scripts/plt_seed_remaining_native_docs.py`

## Key Results
- Exact mapping coverage file now includes all PLT docs (`324/324` entries).
- `316/324` PLT docs received exact Frappe `json_file` candidates and were seeded from original Frappe doctype JSONs under `doc/files/frappe apps/...`.
- Remaining `8/324` docs (no Frappe candidate) were seeded as 3plug-native minimal schemas.
- Final generator pass confirms:
  - `schema_empty_fields = 0` across all `324` PLT docs.

## Decisions (Important)
- `submodule/.../docs/*` is the source of truth, not module `doctype/*`.
- Borrowing priority for translation:
  1. Frappe/original doctype `JSON` (fields/meta/permissions/default sort/view)
  2. Generated/copy baseline for doc runtime `PY`
  3. Generated/copy baseline for doc runtime `JS`
- For this phase, `.py/.js` are generated copy/stubs only (no manual feature logic edits yet).
- When we start implementing backend logic, borrowed `.py` patterns must be adapted to 3plug runtime/manifold structure (tenant-aware, 3plug doc model), not copied wholesale from Frappe.

## Validation Rule for Next Phase
- After translation is complete, run install/seeding and migration validation to prove the docs-first pipeline works before removing scaffold `doctype` artifacts.
- Expected validation sequence:
  1. `install-app` for `platform_core`
  2. migration/application checks in `manifold`
  3. backend API smoke checks
  4. frontend screen API wiring updates

## Reuse Value (ADM / OPS / MGT)
- The PLT translation path is now the template for:
  - `ADM`
  - `OPS`
  - `MGT`
- Reusable pattern proven:
  - exact mapping control file
  - Frappe JSON borrowing for mapped docs
  - native schema seeding for unmapped docs
  - runtime file generation in submodule docs

## Next Steps
- Run PLT install/seeding + migration validation.
- Start backend implementation against the translated PLT docs (manifold-adapted, not Frappe-copy logic).
- Begin replacing screen shell/session fallbacks with real PLT APIs.
- After validation, plan retirement/removal of PLT module `doctype` scaffold artifacts.

## Generator / Dynamic API Follow-up (PLT)
- Fixed CLI migration generator gap where `platform_core_app/urls.py` was empty:
  - `update_urls_app.py` now reads `module/submodule/.../docs` first (legacy `doc/doctype` fallback only).
  - URL generation now runs **after** `migrate_module(...)` so generated viewsets exist before router registration.
- Added generated shared PLT endpoint registration in `platform_core_app/urls.py` (via URL generator):
  - `platform/session/bootstrap`
  - `platform/launcher/catalog`
  - `platform/workspaces`
  - `docs/meta/<doc_key>`
  - `docs/<doc_key>`
  - `docs/<doc_key>/<doc_id>`
  - `docs/<doc_key>/<doc_id>/actions/<action_id>`
- Added `platform_api.py` writer in `migrate_app.py` for `platform_core` so cleanup/migrate runs recreate shared endpoints automatically.
- Verified:
  - `.\3plug.cmd migrate --app platform_core --site dev-site` succeeds
  - `manifold/platform_core_app/urls.py` contains generated router registrations + shared PLT endpoint paths
  - `env\Scripts\python.exe manifold\manage.py check` passes after regenerate
- Frontend resolver update:
  - `src/utils/platformResolver.js` now prefers backend-provided `top_nav` and launcher section payloads first.
  - Existing hardcoded shell nav remains only as temporary fallback until all backend role/navigation payloads are finalized.

## Doc Runtime `.py` Usage (PLT backend)
- Shared PLT endpoint layer now uses generated doc runtime hooks from submodule docs:
  - `bundles/plt/platform_core/<module>/submodule/<submodule>/docs/<doc_key>/<doc_key>.py`
  - loads `DocRuntime` dynamically (file-based import)
- Implemented in generated `platform_core_app/views/platform_api.py` via template:
  - `plt_doc_meta` reads `allowed_actions()` from `DocRuntime` first (falls back to runtime JSON)
  - `plt_doc_action` calls `validate(payload)` and `action_<action_id>(...)`
  - `NotImplementedError` from generated action stubs returns a structured `not_implemented` response (201) so frontend integration can proceed before business logic is finished
- `plt_doc_list` / `plt_doc_detail` now query generated Django models dynamically (by doc_key -> model class) and return DB-backed rows when data exists
- Generator persistence:
  - `plug/sites/migrate/migrate_app.py` now writes `platform_core_app/views/platform_api.py` from template on every migrate run
  - template file: `plug/sites/migrate/templates/platform_core_platform_api.py.tpl`

## Execution Note (important for repeatability)
- Do **not** run `manage.py check` in parallel with `3plug migrate` while generated files are being rewritten.
- Run sequentially:
  1. `.\3plug.cmd migrate --app platform_core --site dev-site`
  2. `env\Scripts\python.exe manifold\manage.py check`

## Sample Data Seeding + Dynamic Endpoint Smoke Checks
- Added Django management command:
  - `manifold/platform_core_app/management/commands/seed_platform_core_demo.py`
- Purpose:
  - seed sample/demo rows across generated PLT wrapper models (`Plt*`) for backend-driven UI testing
  - supports `--per-model`, `--limit-models`, `--only-empty`
- Executed:
  - `env\Scripts\python.exe manifold\manage.py seed_platform_core_demo --per-model 1 --only-empty`
  - Result: `324` rows created across `324` generated PLT models
- Shared PLT endpoint smoke checks (Django test client) after seeding:
  - launcher catalog -> `200`, DB-backed module/submodule record counts present
  - workspaces -> `200`, recent workspace list populated from DB-backed records
  - docs meta -> `200`, `allowed_actions` sourced from `DocRuntime.allowed_actions()`
  - docs list -> `200`, returns seeded DB rows for tested doc (`plt_3_1_bt1_detail`)

## Frontend Sandbox Screen (PLT)
- Added frontend PLT sandbox screen route:
  - `src/pages/platform/sandbox.js`
  - `configKey="platform_sandbox"` in `PltWorkspaceRoute`
- Added workspace screen:
  - `src/components/workspace/screens/PlatformSandboxWorkspace.js`
- Purpose:
  - run the same PLT GET/POST smoke checks from the frontend (browser path)
  - verify payload transmission dynamically against live backend endpoints
  - exercise doc action POST via `postDocAction(...)`
- Sidebar/workspace navigation:
  - added `Sandbox` entry under workspace contextual nav (`/platform/sandbox`)
- Backend sandbox command remains available for server-side verification:
  - `manage.py sandbox_platform_core_api`

## Backend-Owned Shell Model Tightening
- Updated generated PLT shared endpoint template (`platform_api`) to emit:
  - `top_nav` including `Sandbox`
  - `launcher_sections` (backend-owned launcher grouping shape)
- Updated frontend resolver (`src/utils/platformResolver.js`):
  - `topNav` now uses backend payload only (empty-array fallback only; no fabricated route list)
  - `launcherSections` still falls back to derived grouping only when backend launcher sections are absent
  - `accountType` fallback no longer defaults to hardcoded `"business"` (uses `null` if unavailable)
- This reduces frontend data hardcoding and moves shell navigation ownership to the backend contract.

## Exhaustive API Sandbox / Benchmark Upgrade (PLT)
- Added backend sandbox catalog endpoint (generated via `platform_api` template):
  - `GET /apis/platform_core/platform/sandbox/catalog/`
  - Dynamically enumerates shell endpoints + all PLT docs + doc action vocab from `DocRuntime.allowed_actions()`
- Upgraded backend sandbox command:
  - `manifold/platform_core_app/management/commands/sandbox_platform_core_api.py`
  - New flags:
    - `--all-docs`
    - `--all-actions`
    - `--show-packets`
    - `--limit-docs`
  - Outputs request/response packet samples (not just pass/fail)
- Example exhaustive transmission run (sample-limited):
  - `env\Scripts\python.exe manifold\manage.py sandbox_platform_core_api --all-docs --all-actions --limit-docs 2 --show-packets --seed-if-empty`
  - Result: GET/POST checks passed; POST doc actions returned structured `not_implemented` responses from `DocRuntime` stubs (valid transmission path)
- Frontend sandbox screen upgraded:
  - `src/components/workspace/screens/PlatformSandboxWorkspace.js`
  - Fetches API catalog dynamically from backend (`platform/sandbox/catalog`)
  - Supports running selected API and suite checks
  - Displays sampled request/response packets for the selected API result
- Frontend sandbox screen expanded into list/report workbench:
  - dynamic filters by `method`, `scope`, `app`, `module`, `submodule`, `doc`, `action`
  - filtered catalog execution (`Run Selected API`, `Run Catalog Batch`)
  - transmission matrix (list-view style table)
  - grouped report tables for apps/modules/submodules/docs/actions/scope-method
  - metric row + status/method distribution cards for transmission statistics
- This is the baseline benchmark/sandbox pattern to mirror for `ADM / OPS / MGT` and compare against external/reference sandbox behavior (e.g., Frappe-style API transmission matrices).

## PLT Dynamic Screen Tightening (Home / Launcher)
- Backend `platform_api` shared shell payload updated:
  - `workspaces` now returns DB-derived recent workspaces only (no injected static route placeholders)
  - `account.account_type` no longer hardcodes `"business"` (returns `null` until backend account logic is implemented)
  - `top_nav` remains backend-owned via `_build_top_nav()` helper (explicit contract source for route hubs)
- Persisted the same changes in generator template:
  - `plug/sites/migrate/templates/platform_core_platform_api.py.tpl`
- Frontend `/home` (`HomeEntryWorkspace`) tightened:
  - removed temporary forced `Publisher` next-action injection
  - route hub / next actions now rely on backend `top_nav` + real shell payload and existing empty-state behavior
- Frontend `/launcher` (`LauncherWorkspace`) tightened:
  - modules now read from backend `launcherSections[0].modules` only (no fallback to `shell.modules` list)
  - removed temporary UI build-out comments to reflect backend-owned launcher hierarchy direction
- Validation:
  - `node --check src/components/workspace/screens/HomeEntryWorkspace.js`
  - `node --check src/components/workspace/screens/LauncherWorkspace.js`
  - `python -m py_compile manifold/platform_core_app/views/platform_api.py`

## References
- `doc/mapping/plt_doc_translation_and_seeding_plan.md`
- `doc/mapping/plt_doctype_to_doc_mapping_exact.json`
- `doc/mapping/plt_translation_inventory.json`
- `doc/mapping/plt_doctype_to_doc_mapping_seed.json`
- `scripts/plt_generate_doc_runtime.py`
- `scripts/plt_seed_schema_from_exact_frappe_mappings.py`
- `scripts/plt_seed_remaining_native_docs.py`
- `doc/files/frappe apps/frappe_doctypes_inventory.json`

## Task 4 Builder 1 Progress (Doc Builder Desk)
- Expanded Task 4 builder desk inventory to include print, chart, dashboard, page/workspace/menu, automation, notifications, integration/webhook, import/export, dataset, theme, localization, and approval builders.
- Upgraded /workbench/doc-builder into a multi-view desk (Selection, Schema Builder, Form Builder, List/Report Builder, Actions/Permissions).
- Mounted existing studio/doctype/DocStudio in Schema Builder view (drag/drop builder stack).
- Replaced custom docs table with existing pages/list/TableTemplate list stack.
- Added native doc file API route src/pages/api/native-doc-files.js (GET/POST for doc.json, schema.json, ctions.json).
- Wired Builder 1 to load/save native doc files from undle -> app -> module -> submodule -> docs paths.
- Added Form Builder preview using pages/form/FieldRenderer and Actions/Permissions builder using pages/detail/settings/Workflow + SettingsPermissionTable.
